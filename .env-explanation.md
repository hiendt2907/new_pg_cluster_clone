# .env File Explanation

## ‚ùì Why Some Settings Are NOT in .env

### NODE_NAME and NODE_ID
**NOT in .env** - Each node must have unique values!

These are **hardcoded in docker-compose.yml** per service:

```yaml
services:
  pg-1:
    environment:
      - NODE_NAME=pg-1    # Unique for each node
      - NODE_ID=1         # Unique for each node
      
  pg-2:
    environment:
      - NODE_NAME=pg-2    # Different!
      - NODE_ID=2         # Different!
```

**Why?** 
- Each PostgreSQL node needs a **unique identity**
- Cannot share the same NODE_ID across all nodes
- Must be hardcoded per service in docker-compose.yml

---

## ‚úÖ What IS in .env

### 1. Passwords (SHARED across all nodes)
```bash
POSTGRES_PASSWORD=xxxxx        # Same password on all nodes
REPMGR_PASSWORD=xxxxx          # Same password on all nodes
APP_READWRITE_PASSWORD=xxxxx   # Same password on all nodes
APP_READONLY_PASSWORD=xxxxx    # Same password on all nodes
```

**Why in .env?**
- All nodes must use the **same passwords** to communicate
- Easier to manage one set of credentials
- Secure (not committed to Git)

### 2. Network Settings (SHARED)
```bash
NETWORK_SUBNET=172.20.0.0/16
PGPOOL_PORT=15432
GRAFANA_PORT=3001
```

**Why in .env?**
- Same across entire deployment
- Can be customized per environment

### 3. PostgreSQL Version (SHARED)
```bash
POSTGRES_VERSION=17.6
```

**Why in .env?**
- All nodes run same version
- Easy to upgrade all at once

---

## üö´ Common Mistakes

### ‚ùå WRONG: Putting NODE_NAME in .env
```bash
# .env
NODE_NAME=pg-1  # ‚ùå This would make ALL nodes named "pg-1"!
```

### ‚úÖ CORRECT: Hardcoded in docker-compose.yml
```yaml
# docker-compose.yml
services:
  pg-1:
    environment:
      - NODE_NAME=pg-1  # ‚úÖ Unique per service
  pg-2:
    environment:
      - NODE_NAME=pg-2  # ‚úÖ Different name
```

---

## üìã Summary

| Setting | Location | Reason |
|---------|----------|--------|
| `POSTGRES_PASSWORD` | `.env` | Shared across all nodes |
| `REPMGR_PASSWORD` | `.env` | Shared across all nodes |
| `PGPOOL_PORT` | `.env` | Shared configuration |
| `NODE_NAME` | `docker-compose.yml` | **Unique per node** |
| `NODE_ID` | `docker-compose.yml` | **Unique per node** |
| `PEERS` | `docker-compose.yml` | **Different per node** |

**Rule of thumb:**
- **Shared values** ‚Üí `.env`
- **Unique values** ‚Üí `docker-compose.yml`

